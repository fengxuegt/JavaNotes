# 事务

## 概念
事务是一组操作的集合；只能同时成功，或者同时失败；

# 操作
### 开启事务
start transaction

### 提交事务
commit

### 回滚事务
rollback

## 例子

删除部门和删除部门下的员工；

spring中提供了事务的注解；
@Transactional
注解可以配置在service层的方法、类、接口上；
作用：将当前方法交给Spring进行事务管理，方法执行前开启事务，如果方法成功执行完毕，那么提交事务，如果方法出现异常，就回滚事务；


## 事务进阶

### rollbackFor属性
默认情况下，加上事务注解的方法只有在出现RuntimeException时才会出现回滚。rollbackFor用于控制出现何种异常类型时才回滚事务；
![[Pasted image 20231127225613.png]]

### propagation
事务传播行为：指的是当一个事务方法被另一个事务方法调用时，这个事务方法如何进行事务控制；
![[Pasted image 20231127225913.png]]
具体的例子就是日志的记录，在finally代码块中进行日志的记录；

如果使用默认的配置，那么就会加入到解散部门的事务当中，插入日志的操作会跟着这个事务一起回滚；
因此必须改变事务的配置，让插入日志的动作新开启一个事务才行；

大部分情况下只需要使用required这个传播行为即可；
少部分情况下，当我们不希望事务之间相互影响时，可以使用该传播行为；比如案例中的记录日志行为；









